#!/bin/bash
# GENERATED BY PUPPET - do not modify by hand

# This script provides the tools for getting files and databases imported from the production backups to a new environment
# Don't run the script directly. Instead, use one of the wrapper scripts depending on what functions you need to trigger
export OS_AUTH_URL='<%= @backup["os_auth_url"] %>'
export OS_REGION_NAME='<%= @backup["region"] %>'
export OS_TENANT_ID='<%= @backup["tenant"] %>'
export OS_USERNAME='<%= @backup["username"] %>'
export OS_PASSWORD='<%= @backup["password"] %>'
CONTAINER_PREFIX='<%= @backup["container_prefix"] %>'

WWW_CONTAINER=$(swift list | grep "^${CONTAINER_PREFIX}20[0-9][0-9]-[0,1][0-9]-www" | sort | tail -n 1)
DB_CONTAINER=$(swift list | grep "^${CONTAINER_PREFIX}20[0-9][0-9]-[0,1][0-9]-db" | sort | tail -n 1)
RESTORE_DIR="<%= @restore_dir %>"
WEB_DIR="<%= @web_dir %>"

if [ -z "${WWW_CONTAINER}" ] ; then
  echo "No www backup container (${OS_TENANT_ID}/${OS_USERNAME}@${OS_REGION_NAME}:${CONTAINER_PREFIX}*-www) could be found."
  exit 1
fi

if [ -z "${DB_CONTAINER}" ] ; then
  echo "No database backup container (${OS_TENANT_ID}/${OS_USERNAME}@${OS_REGION_NAME}:${CONTAINER_PREFIX}*-db) could be found."
  exit 1
fi

restore_www() {
  cd "$WEB_DIR"
  echo "Downloading www backup from the container ${WWW_CONTAINER}..."
  swift download --snet --object-threads 50 --skip-identical "${WWW_CONTAINER}"

  # File ownership and permissions
  echo "Setting ownership..."
  chown -R www-data:www-data ${WEB_DIR}

  echo "Setting permissions on directories..."
  find ${WEB_DIR} -type d -perm -775 -exec chmod 775 {} \;

  echo "Setting permissions on files..."
  find ${WEB_DIR} -type f -perm -664 -exec chmod 664 {} \;
}

download_db() {
  echo "Downloading ${DB_NAME} database backups from the container ${DB_CONTAINER}..."
  cd "${RESTORE_DIR}"
  swift download --snet --skip-identical "${DB_CONTAINER}" ${DB_NAME}.sql.gz
  if [ -f "${RESTORE_DIR}/${DB_NAME}.sql.gz" ] ; then
    gzip -q -f -d ${RESTORE_DIR}/${DB_NAME}.sql.gz
  else
    echo "ERROR: Downloading ${DB_NAME}.sql.gz from ${DB_CONTAINER} failed..."
    exit 1
  fi
}

repair_db() {
  if [ -f "${RESTORE_DIR}/${DB_NAME}.sql" ] ; then
    echo "Running sed to repair ${DB_NAME} dump before import..."
    sed -i s/'\/\*!50001 CREATE ALGORITHM=UNDEFINED \*\//\/\*!50001 CREATE \*\/'/g ${RESTORE_DIR}/${DB_NAME}.sql
    sed -i s/'\/\*!50013 DEFINER=`.\+`@`%` SQL SECURITY DEFINER \*\/'//g ${RESTORE_DIR}/${DB_NAME}.sql
    sed -i s/'\/\*!4.\+ SET .\+=@.\+ \*\/;'//g ${RESTORE_DIR}/${DB_NAME}.sql
  else
    echo "ERROR: Could not find ${RESTORE_DIR}/${DB_NAME}.sql..."
    exit 1
  fi
}

import_db() {
  if [ -f "${RESTORE_DIR}/${DB_NAME}.sql" ] ; then
    SPLIT_DIR=${RESTORE_DIR}/splits
    mkdir -p ${SPLIT_DIR}
    echo "Splitting and importing SQL for $DB_NAME..."
    csplit --quiet --keep-files --prefix="${SPLIT_DIR}/_${DB_NAME}" ${RESTORE_DIR}/${DB_NAME}.sql "/-- Table structure for table/" {*}
    for FILE in `ls ${SPLIT_DIR} | sort`; do
      current_file="${SPLIT_DIR}/${FILE}"
      mysql --host="$DB_HOST" --user="$DB_USER" --password="$DB_PASS" --database="$DB_NAME" --execute="SOURCE ${current_file}"
      # TODO : check the output/errorstate of mysql; if it's an error, perhaps try the command again. (MySQL server went away...)
      rm ${current_file}
      echo -n .
    done
    echo -e "\nDone importing $DB_NAME."
    rmdir ${SPLIT_DIR}
    echo "Finished importing databases."
  else
    echo "ERROR: Could not find ${RESTORE_DIR}/${DB_NAME}.sql..."
    exit 1
  fi
}

restore_databases() {
  # iterate through databases and get each one
<% @databases.each do |database, setting| -%>
  echo "Processing <%= database %>..."
  # set variables for <%= database %>
  DB_HOST="<%= setting["host"] %>"
  DB_USER="<%= setting["user"] %>"
  DB_PASS="<%= setting["password"] %>"
  DB_NAME="<%= database %>"

  # download and import <%= database %>
  download_db
  repair_db
  import_db

<% end -%>
}

alter_config() {
  # alter the application configuration files.

  # Joomla! configuration
  echo "Creating Joomla! configuration.php..."
  cat >${WEB_DIR}/configuration.php<<EOL
<?php
class JConfig {
  var \$offline = '0';
  var \$editor = 'jce';
  var \$list_limit = '20';
  var \$helpurl = '';
  var \$debug = '0';
  var \$debug_lang = '0';
  var \$sef = '1';
  var \$sef_rewrite = '1';
  var \$sef_suffix = '1';
  var \$feed_limit = '10';
  var \$feed_email = 'author';
  var \$secret = '67xeOiusS6gJjIon';
  var \$gzip = '1';
  var \$error_reporting = '-1';
  var \$xmlrpc_server = '0';
  var \$log_path = '${WEB_DIR}/logs';
  var \$tmp_path = '${WEB_DIR}/tmp';
  var \$live_site = 'http://<%= @joomla_config["fqdn"] %>/';
  var \$force_ssl = '0';
  var \$offset = '-8';
  var \$caching = '1';
  var \$cachetime = '15';
  var \$cache_handler = 'file';
  var \$memcache_settings = array();
  var \$ftp_enable = '0';
  var \$ftp_host = '127.0.0.1';
  var \$ftp_port = '21';
  var \$ftp_user = '';
  var \$ftp_pass = '';
  var \$ftp_root = '';
  var \$dbtype = 'mysql';
  var \$host = '<%= @joomla_db["host"] %>';
  var \$user = '<%= @joomla_db["user"] %>';
  var \$db = '<%= @joomla_db["database"] %>';
  var \$dbprefix = 'jos_';
  var \$mailer = '<%= @joomla_config["mailer"] %>';
  var \$mailfrom = '<%= @joomla_config["mailfrom"] %>';
  var \$fromname = '<%= @joomla_config["fromname"] %>';
  var \$sendmail = '/usr/sbin/sendmail';
  var \$smtpauth = '<%= @joomla_config["smtpauth"] %>';
  var \$smtpsecure = 'none';
  var \$smtpport = '25';
  var \$smtpuser = '<%= @joomla_config["smtpuser"] %>';
  var \$smtppass = '<%= @joomla_config["smtppass"] %>';
  var \$smtphost = '<%= @joomla_config["smtphost"] %>';
  var \$MetaAuthor = '1';
  var \$MetaTitle = '1';
  var \$lifetime = '180';
  var \$session_handler = 'database';
  var \$password = '<%= @joomla_db["password"] %>';
  var \$sitename = '<%= @joomla_config["sitename"] %>';
  var \$MetaDesc = 'Bullseye Glass Co. is a leader in promoting glass art worldwide through quality production of colored glass for art and architecture, research and education, and the presentation of innovative glass art in its Portland gallery.';
  var \$MetaKeys = 'Bullseye Glass, Bullseye, glass, art glass, glass fusing, fusible, compatible glass, kilnforming';
  var \$offline_message = 'This site is down for maintenance. Please check back again soon.';
}
?>
EOL

  # Post Affiliate Pro configuration
  echo "Creating PAP settings.php..."
  cat >${WEB_DIR}/affiliate/accounts/settings.php<<EOL
<?php /*
LICENSE=kG6JUAwMDAyCFyzinG00DW0HXRFHDPjou/nwFxZUyCco8sjouK8ipIvufgaqrui0S7yFKebjaWa/HP+h9O4a4ccY6xn1qIoaqtSPbShJo5kAyhPmFLRV1pBh2m1nvSnzU8yrRlN6fRGqFbuoRKMqkBZrNeLJNsRR7qQGb8MSvvF65adnIPQqQlGUcMNj8zxcnj3eFVxXV7HswDgtiPlD2a/vGfE6E5l0g0SYD0YyRn5V7El7BPZX0KZ91nm3YVy0Mw/R4IFCzsGZMkXyiXjzU3JCPeTf3Vm9DmKgPJQPPKbEEcaXk6wD0To/DWp/G91Su024dqFBLbEaMR8gTb7XPjV1SmWLT6VqulqAUBlkD9WOYXZ9Na68HfsD/E25RXq5NcjEtMblgkP47l2yJsXnHqwEUuPdiGIVKoHS6vH1K7auOT30FhKoOA9I78/xEAzaYuSMl9I/mIBEb4bTbycPOSw7bhnYsg8hoaSvxSkWBeCoUuxk54werRQ+u+lQH25PmkN6hxfxPLOUah1TaY2MbCoYMpPYLJp8Ofx1RDSNzoptDSb7FJWnut6QkxIm/Kds06sDPr+N56hJJ0kFbF3ULPGTliATEh9PUnNhXezFCzbIOEocodJHGXXYr/UGVCNZvpngHt0D26OWFnZP+ifqsLB9oUXOZx2IOOevI3BfoKm8mH1yGFNILX6rzyx8m849JqyJNfCUQmT+HDhUlHyqqcDc92XQBsqikma19wVvcktBrQVlUD/oy5V0hdxIufMz/O4BiL4qCkaA6Cz9ttUEECzeD3bIb5/6AaiTPQshE7M6o/fe0I3CvdjGOVxF7F7DlD9BXgnDX11uMFGIrYCMy8TdyjPCLJb0NB0O82Kdr3ntJZ3IwCgL9PkK64B1Ua3yOhf6ngPrZZkDnXGjtqcAeNH7
DB_HOSTNAME=<%= @pap_db["host"] %>
DB_USERNAME=<%= @pap_db["user"] %>
DB_PASSWORD=<%= @pap_db["password"] %>
DB_DATABASE=<%= @pap_db["database"] %>
impTableInput=0
impTableProcess=2
visitsTableInput=2
visitsTableProcess=2
param_name_user_id=a_aid
param_name_banner_id=a_bid
param_name_campaign_id=a_cid
param_name_rotator_id=a_rid
param_name_dest_url=desturl
param_name_extra_data1=data1
param_name_extra_data2=data2
p3p_policy_compact=NOI NID ADMa DEVa PSAa OUR BUS ONL UNI COM STA OTC
url_to_p3p=
serverName=<%= @joomla_config["fqdn"] %>
baseServerUrl=/affiliate/
overwrite_cookie=Y
delete_cookie=N
cookie_domain=bullseyeglass.com
bannedips_clicks_from_iframe=Y
cronLastRun=2012-11-12 15:40:01
serverOverloadInterruptions=0
FTP_USERNAME=cpetraus
FTP_PASSWORD=d4hep&ag4nuJayeb
FTP_HOSTNAME=67.192.187.185
FTP_DIRECTORY=/var/www/html/affiliate/
debug_types=E
*/ ?>
EOL

  # PhpBB configuration
  echo "Creating PhpBB common.php and config.php..."
  cat >${WEB_DIR}/forums/common.php<<EOL
<?php
//JFUSION REDIRECT START
//SET SOME VARS
if (!empty(\$_COOKIE['phpbb3_kqiz6_u']))
{
    \$current_userid = \$_COOKIE['phpbb3_kqiz6_u'];
} else {
    \$current_userid = '';
}
\$joomla_url = 'http://<%= @joomla_config["fqdn"] %>/';
\$joomla_itemid = 224;
\$file = \$_SERVER['SCRIPT_NAME'];
\$break = Explode('/', \$file);
\$pfile = \$break[count(\$break) - 1];

\$jfile = '';
if (isset(\$_GET['jfile'])) {
     \$jfile = \$_GET['jfile'];
}

\$mod_ids = array(53,58,56,61,87,9139,1192,54,11226,10236,11784,15838);
if (!defined('_JEXEC') && !defined('ADMIN_START') && !defined('IN_MOBIQUO') && \$pfile != 'file.php' && \$jfile != 'file.php' && \$pfile != 'feed.php' && \$jfile != 'feed.php' && !in_array(\$current_userid, \$mod_ids))
{
    \$jfusion_url = \$joomla_url . 'index.php?option=com_jfusion&Itemid=' . \$joomla_itemid . '&jfile='.\$pfile. '&' . \$_SERVER['QUERY_STRING'];
    header('Location: ' . \$jfusion_url);
}
//JFUSION REDIRECT END











  /**
*
* @package phpBB3
* @version \$Id\$
* @copyright (c) 2005 phpBB Group
* @license http://opensource.org/licenses/gpl-license.php GNU Public License
*
* Minimum Requirement: PHP 4.3.3
  */

/**
*/
if (!defined('IN_PHPBB'))
  {
  exit;
  }

require(\$phpbb_root_path . 'includes/startup.' . \$phpEx);

if (file_exists(\$phpbb_root_path . 'config.' . \$phpEx))
{
  require(\$phpbb_root_path . 'config.' . \$phpEx);
}

if (!defined('PHPBB_INSTALLED'))
{
  // Redirect the user to the installer
  require(\$phpbb_root_path . 'includes/functions.' . \$phpEx);

  // We have to generate a full HTTP/1.1 header here since we can't guarantee to have any of the information
  // available as used by the redirect function
  \$server_name = (!empty(\$_SERVER['HTTP_HOST'])) ? strtolower(\$_SERVER['HTTP_HOST']) : ((!empty(\$_SERVER['SERVER_NAME'])) ? \$_SERVER['SERVER_NAME'] : getenv('SERVER_NAME'));
  \$server_port = (!empty(\$_SERVER['SERVER_PORT'])) ? (int) \$_SERVER['SERVER_PORT'] : (int) getenv('SERVER_PORT');
  \$secure = (isset(\$_SERVER['HTTPS']) && \$_SERVER['HTTPS'] == 'on') ? 1 : 0;

  \$script_name = (!empty(\$_SERVER['PHP_SELF'])) ? \$_SERVER['PHP_SELF'] : getenv('PHP_SELF');
  if (!\$script_name)
  {
    \$script_name = (!empty(\$_SERVER['REQUEST_URI'])) ? \$_SERVER['REQUEST_URI'] : getenv('REQUEST_URI');
  }

  // \$phpbb_root_path accounts for redirects from e.g. /adm
  \$script_path = trim(dirname(\$script_name)) . '/' . \$phpbb_root_path . 'install/index.' . \$phpEx;
  // Replace any number of consecutive backslashes and/or slashes with a single slash
  // (could happen on some proxy setups and/or Windows servers)
  \$script_path = preg_replace('#[\\\\/]{2,}#', '/', \$script_path);
  // Eliminate . and .. from the path
  \$script_path = phpbb_clean_path(\$script_path);

  \$url = ((\$secure) ? 'https://' : 'http://') . \$server_name;

  if (\$server_port && ((\$secure && \$server_port <> 443) || (!\$secure && \$server_port <> 80)))
  {
    // HTTP HOST can carry a port number...
    if (strpos(\$server_name, ':') === false)
    {
      \$url .= ':' . \$server_port;
    }
  }

  \$url .= \$script_path;
  header('Location: ' . \$url);
  exit;
}

if (defined('DEBUG_EXTRA'))
{
  \$base_memory_usage = 0;
  if (function_exists('memory_get_usage'))
  {
    \$base_memory_usage = memory_get_usage();
  }
}

// Load Extensions
// dl() is deprecated and disabled by default as of PHP 5.3.
if (!empty(\$load_extensions) && function_exists('dl'))
{
  \$load_extensions = explode(',', \$load_extensions);

  foreach (\$load_extensions as \$extension)
  {
    @dl(trim(\$extension));
  }
}

// Include files
require(\$phpbb_root_path . 'includes/acm/acm_' . \$acm_type . '.' . \$phpEx);
require(\$phpbb_root_path . 'includes/cache.' . \$phpEx);
require(\$phpbb_root_path . 'includes/template.' . \$phpEx);
require(\$phpbb_root_path . 'includes/session.' . \$phpEx);
require(\$phpbb_root_path . 'includes/auth.' . \$phpEx);

require(\$phpbb_root_path . 'includes/functions.' . \$phpEx);
require(\$phpbb_root_path . 'includes/functions_content.' . \$phpEx);

require(\$phpbb_root_path . 'includes/constants.' . \$phpEx);
require(\$phpbb_root_path . 'includes/db/' . \$dbms . '.' . \$phpEx);
require(\$phpbb_root_path . 'includes/utf/utf_tools.' . \$phpEx);

// Set PHP error handler to ours
set_error_handler(defined('PHPBB_MSG_HANDLER') ? PHPBB_MSG_HANDLER : 'msg_handler');

// Instantiate some basic classes
\$user		= new user();
\$auth		= new auth();
\$template	= new template();
\$cache		= new cache();
\$db			= new \$sql_db();

// Connect to DB
\$db->sql_connect(\$dbhost, \$dbuser, \$dbpasswd, \$dbname, \$dbport, false, defined('PHPBB_DB_NEW_LINK') ? PHPBB_DB_NEW_LINK : false);

// We do not need this any longer, unset for safety purposes
unset(\$dbpasswd);

// Grab global variables, re-cache if necessary
\$config = \$cache->obtain_config();

// Add own hook handler
require(\$phpbb_root_path . 'includes/hooks/index.' . \$phpEx);
\$phpbb_hook = new phpbb_hook(array('exit_handler', 'phpbb_user_session_handler', 'append_sid', array('template', 'display')));

foreach (\$cache->obtain_hooks() as \$hook)
{
  @include(\$phpbb_root_path . 'includes/hooks/' . \$hook . '.' . \$phpEx);
}

?>
EOL

  cat >${WEB_DIR}/forums/config.php<<EOL
<?php
// phpBB 3.0.x auto-generated configuration file
// Do not change anything in this file!
\$dbms = 'mysqli';
\$dbhost = '<%= @joomla_db["host"] %>';
\$dbport = '3306';
\$dbname = '<%= @joomla_db["database"] %>';
\$dbuser = '<%= @joomla_db["user"] %>';
\$dbpasswd = '<%= @joomla_db["password"] %>';
\$table_prefix = 'phpbb_';
\$acm_type = 'file';
\$load_extensions = '';

@define('PHPBB_INSTALLED', true);
// @define('DEBUG', true);
// @define('DEBUG_EXTRA', true);
?>
EOL

  # jFusion configuration
  echo "Updating jFusion (Joomla / PhpBB) configuration..."
  WEB_URL="http://<%= @joomla_config["fqdn"] %>/"
  WEB_URL_COUNT=${#WEB_URL}
  SOURCE_URL="${WEB_URL}forums/"
  SOURCE_URL_COUNT=${#SOURCE_URL}
  SOURCE_PATH="${WEB_DIR}/forums"
  SOURCE_PATH_COUNT=${#SOURCE_PATH}
  DB_HOST=<%= @joomla_db["host"] %>
  DB_HOST_COUNT=${#DB_HOST}
  DB_PRIMARY_NAME=<%= @joomla_db["database"] %>
  DB_PRIMARY_NAME_COUNT=${#DB_PRIMARY_NAME}
  DB_PRIMARY_USER=<%= @joomla_db["user"] %>
  DB_PRIMARY_USER_COUNT=${#DB_PRIMARY_USER}
  DB_PRIMARY_PASS=<%= @joomla_db["password"] %>
  DB_PRIMARY_PASS_COUNT=${#DB_PRIMARY_PASS}

  # Joomla Plugin
  JSON="a:18:{s:11:\"description\";s:15:\"Bullseye Joomla\";s:10:\"source_url\";s:${WEB_URL_COUNT}:\"${WEB_URL}\";s:16:\"login_identifier\";s:1:\"1\";s:16:\"case_insensitive\";s:1:\"0\";s:15:\"username_filter\";s:10:\"joomla_int\";s:9:\"usergroup\";s:2:\"18\";s:12:\"autoregister\";s:1:\"0\";s:17:\"update_activation\";s:1:\"1\";s:12:\"update_email\";s:1:\"1\";s:12:\"update_block\";s:1:\"1\";s:15:\"create_inactive\";s:1:\"1\";s:14:\"create_blocked\";s:1:\"1\";s:17:\"allow_connections\";s:1:\"0\";s:6:\"secret\";s:10:\"96c4be18b8\";s:20:\"allow_redirect_login\";s:1:\"0\";s:21:\"allow_redirect_logout\";s:1:\"0\";s:17:\"redirecturl_login\";s:0:\"\";s:18:\"redirecturl_logout\";s:0:\"\";}"
  BASE64="$(echo ${JSON} | base64 | tr -d '\n')"
  SQL="UPDATE jos_jfusion SET params = '${BASE64}' WHERE id = 1;"
  mysql --host=${DB_HOST} --user=${DB_PRIMARY_USER} --password=${DB_PRIMARY_PASS} --database=${DB_PRIMARY_NAME} --execute="${SQL}"

  # PhpBB Plugin
  JSON="a:35:{s:11:\"description\";s:6:\"phpBB3\";s:10:\"source_url\";s:${SOURCE_URL_COUNT}:\"${SOURCE_URL}\";s:11:\"source_path\";s:${SOURCE_PATH_COUNT}:\"${SOURCE_PATH}\";s:16:\"login_identifier\";s:1:\"3\";s:10:\"login_type\";s:1:\"0\";s:13:\"database_type\";s:5:\"mysql\";s:13:\"database_host\";s:${DB_HOST_COUNT}:\"${DB_HOST}\";s:13:\"database_name\";s:${DB_PRIMARY_NAME_COUNT}:\"${DB_PRIMARY_NAME}\";s:13:\"database_user\";s:${DB_PRIMARY_USER_COUNT}:\"${DB_PRIMARY_USER}\";s:17:\"database_password\";s:${DB_PRIMARY_PASS_COUNT}:\"${DB_PRIMARY_PASS}\";s:15:\"database_prefix\";s:6:\"phpbb_\";s:16:\"database_charset\";s:4:\"utf8\";s:17:\"database_new_link\";s:1:\"0\";s:9:\"usergroup\";s:1:\"2\";s:17:\"update_activation\";s:1:\"1\";s:12:\"update_email\";s:1:\"1\";s:12:\"update_block\";s:1:\"1\";s:15:\"create_inactive\";s:1:\"1\";s:14:\"create_blocked\";s:1:\"1\";s:18:\"allow_delete_users\";s:1:\"1\";s:13:\"utf8_advanced\";s:8:\"disabled\";s:13:\"cookie_domain\";s:18:\".bullseyeglass.com\";s:11:\"cookie_path\";s:1:\"/\";s:13:\"cookie_prefix\";s:12:\"phpbb3_kqiz6\";s:6:\"secure\";s:1:\"0\";s:8:\"httponly\";s:1:\"0\";s:15:\"allow_autologin\";s:1:\"1\";s:7:\"sefmode\";s:1:\"0\";s:15:\"redirect_itemid\";s:3:\"224\";s:7:\"mod_ids\";s:1:\"1\";s:16:\"lostpassword_url\";s:20:\"forgot-password.html\";s:12:\"register_url\";s:55:\"index.php?option=com_community&view=register&Itemid=238\";s:16:\"edit_account_url\";s:0:\"\";s:16:\"edit_profile_url\";s:0:\"\";s:15:\"edit_avatar_url\";s:0:\"\";}"
  BASE64="$(echo ${JSON} | base64 | tr -d '\n')"
  SQL="UPDATE jos_jfusion SET params = '${BASE64}' WHERE id = 4;"
  mysql --host=${DB_HOST} --user=${DB_PRIMARY_USER} --password=${DB_PRIMARY_PASS} --database=${DB_PRIMARY_NAME} --execute="${SQL}"
}

update_images() {
  echo "Found: using container ${WWW_CONTAINER}..."
  cd "$WEB_DIR"
  cd .. # this is so that the restore gets www in the right place
  echo "Downloading images, 1/5..."
  swift download --object-threads=50 --skip-identical --prefix="www/affiliate/accounts/default1/banners" ${WWW_CONTAINER}

  echo "Downloading images, 2/5..."
  swift download --object-threads=50 --skip-identical --prefix="www/components/com_rsevents/assets/images" ${WWW_CONTAINER}

  echo "Downloading images, 3/5..."
  swift download --object-threads=50 --skip-identical --prefix="www/components/com_wordpress/wp/wp-content/uploads" ${WWW_CONTAINER}

  echo "Downloading images, 4/5..."
  swift download --object-threads=50 --skip-identical --prefix="www/forums/files" ${WWW_CONTAINER}

  echo "Downloading images, 5/5..."
  swift download --object-threads=50 --skip-identical --prefix="www/images" ${WWW_CONTAINER}
}

# TODO: Consider deleting /root/bullseye-infrastructure-data/hieradata/secrets.yaml
# TODO: This would be the point at which we'd update a Load Balancer with the IP address of the new stack
